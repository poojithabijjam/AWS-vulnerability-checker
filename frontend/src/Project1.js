import { Button, Spinner } from "react-bootstrap";
import "./Project1.css";
import React, { useContext, useState, useCallback, useReducer, useEffect } from "react";
import ContentsPage from "./components/ContentsPage";
import Intro from "./components/Intro";
import Spin from "./components/Spin";
import axios from "axios";

function Project1() {
  const [result, setResult] = useState({
    ep: { status: "0", data: [] },
    cj: { status: "0", data: [] },
  });
  const [isActivated, setActivated] = useState(false);

  useEffect(() => {
    if (isActivated) {
      axios
        .get("http://localhost:5000/api/v1/checkall")
        .then((res) => {
          if (res.status === 200) {
            setResult(res.data);
          }
        })
        .then(() => {
          setActivated(false);
        })
        .catch(() => {
          setActivated(false);
          alert("Cannot reach the server!! Please Retry");
        });
    }
  }, [isActivated]);

  const processClick = (type) => () => {
    if (type === "cj") {
      axios.get("http://localhost:5000/api/v1/cloudjack").then((res) => {
        if (res.status === 200) {
          setResult((prev) => {
            return {
              ...prev,
              cj: res.data,
            };
          });
        }
      });
    } else {
      axios.get("http://localhost:5000/api/v1/exposedports").then((res) => {
        if (res.status === 200) {
          setResult((prev) => {
            return {
              ...prev,
              ep: res.data,
            };
          });
        }
      });
    }
  };

  return (
    <div className="Project1">
      <Intro />
      <ContentsPage result={result} processClick={processClick} />
      <Button
        variant="primary"
        disabled={isActivated}
        onClick={() => setActivated(true)}
        padding={"25px"}
      >
        {isActivated ? (
          <Spin />
        ) : (
          "Run All Tests"
        )}
      </Button>
    </div>
  );
}

export default Project1;
